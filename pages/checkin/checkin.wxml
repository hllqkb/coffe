<!--pages/checkin/checkin.wxml-->
<view class="checkin-container">
  <!-- 头部背景 -->
  <view class="header-bg">
    <image src="/images/checkin-bg.jpg" mode="aspectFill"></image>
    <view class="header-overlay"></view>
  </view>

  <!-- 用户信息卡片 -->
  <view class="user-card">
    <view class="user-avatar">
      <image src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
    </view>
    <view class="user-info">
      <text class="nickname">{{userInfo.nickName || '咖啡爱好者'}}</text>
      <view class="level-info">
        <text class="level">连续签到 {{consecutiveDays}} 天</text>
      </view>
    </view>
  </view>

  <!-- 签到状态 -->
  <view class="checkin-status">
    <view class="status-item">
      <text class="status-label">已连续签到</text>
      <text class="status-value">{{consecutiveDays}}</text>
      <text class="status-unit">天</text>
    </view>
    <view class="status-item">
      <text class="status-label">累计签到</text>
      <text class="status-value">{{totalDays}}</text>
      <text class="status-unit">天</text>
    </view>
  </view>

  <!-- 签到按钮 -->
  <view class="checkin-button-area">
    <button class="checkin-btn {{isCheckedIn ? 'checked' : ''}}" 
            bindtap="performCheckin" 
            disabled="{{isCheckedIn || loading}}">
      <view class="btn-content">
        <text class="btn-text">{{isCheckedIn ? '已签到' : '立即签到'}}</text>
        <view class="btn-icon" wx:if="{{!isCheckedIn}}">
          <image src="/images/checkin.png" mode="aspectFit"></image>
        </view>
      </view>
    </button>
  </view>

  <!-- 签到奖励日历 -->
  <view class="reward-calendar">
    <view class="calendar-title">签到奖励</view>
    <view class="calendar-grid">
      <view class="reward-item {{index < checkinInfo.consecutiveDays % 7 ? 'received' : ''}} {{index === checkinInfo.consecutiveDays % 7 && !checkinInfo.todayChecked ? 'today' : ''}}" 
            wx:for="{{checkinRewards}}" wx:key="day">
        <view class="reward-day">第{{item.day}}天</view>
        <view class="reward-icon">
          <image src="{{item.icon}}"></image>
          <view class="reward-amount">{{item.amount}}</view>
        </view>
        <view class="reward-name">{{item.name}}</view>
        <view class="received-mark" wx:if="{{index < checkinInfo.consecutiveDays % 7}}">
          <image src="/images/icons/check-mark.png"></image>
        </view>
      </view>
    </view>
  </view>

  <!-- 资源展示 -->
  <view class="resources-display">
    <view class="resource-item" wx:for="{{resources}}" wx:key="name">
      <image src="{{item.icon}}" class="resource-icon"></image>
      <text class="resource-count">{{item.count}}</text>
      <text class="resource-name">{{item.name}}</text>
    </view>
  </view>

  <!-- 快捷操作 -->
  <view class="quick-actions">
    <view class="action-button" bindtap="viewCheckinHistory">
      <image src="/images/icons/history.png"></image>
      <text>签到历史</text>
    </view>
    <view class="action-button" bindtap="shareCheckin">
      <image src="/images/icons/share.png"></image>
      <text>分享签到</text>
    </view>
    <view class="action-button" bindtap="goToShop">
      <image src="/images/icons/shop.png"></image>
      <text>前往商店</text>
    </view>
  </view>

  <!-- 底部导航 -->
  <view class="bottom-nav">
    <view class="nav-button" bindtap="goHome">
      <image src="/images/icons/home.png"></image>
      <text>返回首页</text>
    </view>
  </view>

  <!-- 奖励弹窗 -->
  <view class="reward-modal" wx:if="{{showRewardModal}}">
    <view class="modal-mask" bindtap="closeRewardModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">签到成功！</text>
        <view class="close-btn" bindtap="closeRewardModal">
          <image src="/images/close.png"></image>
        </view>
      </view>
      <view class="modal-body">
        <view class="reward-info">
          <image src="{{rewardResult.icon}}" class="reward-icon"></image>
          <text class="reward-name">获得 {{rewardResult.name}}</text>
          <text class="reward-amount">+{{rewardResult.amount}}</text>
        </view>
        <view class="consecutive-info">
          <text>连续签到 {{consecutiveDays}} 天</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="confirm-btn" bindtap="closeRewardModal">确定</button>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>签到中...</text>
  </view>
</view>