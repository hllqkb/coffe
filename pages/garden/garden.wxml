<!--garden.wxml-->
<view class="container">
  <!-- åº„å›­å¤´éƒ¨ä¿¡æ¯ -->
  <view class="garden-header">
    <view class="header-bg">
      <view class="garden-title">æˆ‘çš„å’–å•¡åº„å›­</view>
      <view class="garden-stats">
        <view class="stat-item">
          <text class="stat-number">{{myTrees.length}}</text>
          <text class="stat-label">å’–å•¡æ ‘</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{harvestedCount}}</text>
          <text class="stat-label">å·²æ”¶è·</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{totalDays}}</text>
          <text class="stat-label">ç§æ¤å¤©æ•°</text>
        </view>
      </view>
    </view>
  </view>

  <!-- èµ„æºæ  -->
  <view class="resources-bar">
    <view class="resource-item">
      <image src="/images/water.png"></image>
      <text>{{waterCount}}</text>
      <button class="resource-btn" bindtap="buyResource" data-type="water">+</button>
    </view>
    <view class="resource-item">
      <image src="/images/fertilizer.png"></image>
      <text>{{fertilizerCount}}</text>
      <button class="resource-btn" bindtap="buyResource" data-type="fertilizer">+</button>
    </view>
    <view class="resource-item">
      <image src="/images/coin.png"></image>
      <text>{{coinCount}}</text>
      <button class="resource-btn" bindtap="buyResource" data-type="coin">+</button>
    </view>
  </view>

  <!-- å’–å•¡æ ‘åˆ—è¡¨ -->
  <view class="trees-container">
    <view class="section-title">æˆ‘çš„å’–å•¡æ ‘</view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{myTrees.length === 0}}">
      <image src="/images/empty-garden.png"></image>
      <text>è¿˜æ²¡æœ‰å’–å•¡æ ‘</text>
      <text>å»é¦–é¡µè®¤é¢†ä¸€æ£µå§ï¼</text>
      <button class="btn btn-primary" bindtap="goToIndex">è®¤é¢†å’–å•¡æ ‘</button>
    </view>

    <!-- å’–å•¡æ ‘å¡ç‰‡ -->
    <view class="tree-card" wx:for="{{myTrees}}" wx:key="_id">
      <view class="tree-header">
        <view class="tree-info">
          <view class="tree-name">{{item.varietyName}}</view>
          <view class="tree-stage">{{item.currentStageName}}</view>
        </view>
        <view class="tree-actions">
          <button class="action-btn" bindtap="viewTreeDetail" data-tree="{{item}}">
            <image src="/images/detail-icon.png"></image>
          </button>
        </view>
      </view>

      <!-- å’–å•¡æ ‘å›¾ç‰‡å’ŒçŠ¶æ€ -->
      <view class="tree-display">
        <view class="tree-image-container">
          <!-- æ˜¾ç¤ºç”¨æˆ·ä¸Šä¼ çš„ç…§ç‰‡æˆ–é»˜è®¤é˜¶æ®µå›¾ç‰‡ -->
          <image class="tree-image" src="{{item.hasPhoto ? item.latestPhoto : item.currentStageImage}}" mode="aspectFill"></image>
          
          <!-- ç…§ç‰‡æ ‡è¯† -->
          <view class="photo-indicator" wx:if="{{item.hasPhoto}}">
            <image src="/images/camera-icon.png"></image>
          </view>
          
          <!-- æˆé•¿è¿›åº¦ -->
          <view class="progress-overlay">
            <view class="progress-container">
              <view class="progress-bar" style="width: {{item.progress}}"></view>
            </view>
            <text class="progress-text">{{item.progress}}%</text>
          </view>
          
          <!-- çŠ¶æ€æ ‡ç­¾ -->
          <view class="status-tags">
            <view class="tag tag-stage">{{item.currentStageName}}</view>
            <view class="tag tag-health {{item.healthStatus}}">{{item.healthText}}</view>
          </view>
        </view>

        <!-- æ ‘çš„è¯¦ç»†ä¿¡æ¯ -->
        <view class="tree-details">
          <view class="detail-item">
            <text class="detail-label">ç§æ¤æ—¶é—´:</text>
            <text class="detail-value">{{item.plantTimeText}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ä¸Šæ¬¡æµ‡æ°´:</text>
            <text class="detail-value">{{item.lastWateredText}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ä¸Šæ¬¡æ–½è‚¥:</text>
            <text class="detail-value">{{item.lastFertilizedText}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">é¢„è®¡æˆç†Ÿ:</text>
            <text class="detail-value">{{item.expectedMatureText}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="tree-operations">
        <button class="operation-btn water-btn" 
                catchtap="waterTree" 
                data-tree="{{item}}"
                disabled="{{waterCount <= 0 || item.cannotWater}}">
          <image src="/images/water-icon.png"></image>
          <text>æµ‡æ°´</text>
          <text class="btn-cost">(-1)</text>
        </button>
        
        <button class="operation-btn fertilizer-btn" 
                catchtap="fertilizeTree" 
                data-tree="{{item}}"
                disabled="{{fertilizerCount <= 0 || item.cannotFertilize}}">
          <image src="/images/fertilizer-icon.png"></image>
          <text>æ–½è‚¥</text>
          <text class="btn-cost">(-1)</text>
        </button>
        
        <button class="operation-btn harvest-btn" 
                catchtap="harvestTree" 
                data-tree="{{item}}"
                wx:if="{{item.canHarvest}}">
          <image src="/images/harvest-icon.png"></image>
          <text>æ”¶è·</text>
        </button>
        
        <button class="operation-btn photo-btn" 
                catchtap="takePhoto" 
                data-tree="{{item}}">
          <image src="/images/camera-icon.png"></image>
          <text>æ‹ç…§</text>
        </button>
      </view>

      <!-- æˆé•¿æ—¥å¿— -->
      <view class="growth-log" wx:if="{{item.showLog}}">
        <view class="log-title">æˆé•¿æ—¥å¿—</view>
        <view class="log-item" wx:for="{{item.growthLog}}" wx:key="time" wx:for-item="log">
          <view class="log-time">{{log.timeText}}</view>
          <view class="log-content">{{log.content}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº„å›­è£…é¥° -->
  <view class="garden-decorations" wx:if="{{myTrees.length > 0}}" style="width: 454rpx; display: block; box-sizing: border-box">
    <view class="section-title">åº„å›­è£…é¥°</view>
    <scroll-view class="decorations-scroll" scroll-x="true">
      <view class="decoration-item" wx:for="{{decorations}}" wx:key="id">
        <image src="{{item.image}}"></image>
        <text>{{item.name}}</text>
        <button class="decoration-btn" bindtap="addDecoration" data-decoration="{{item}}">æ·»åŠ </button>
      </view>
    </scroll-view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® -->
  <view class="floating-actions">
    
  </view>
</view>

<!-- æ“ä½œç¡®è®¤æ¨¡æ€æ¡† -->
<view class="modal" wx:if="{{showActionModal}}">
  <view class="modal-content">
    <view class="modal-header">{{actionModal.title}}</view>
    <view class="modal-body">
      <text>{{actionModal.content}}</text>
      <view class="cost-info" wx:if="{{actionModal.cost}}">
        <text>æ¶ˆè€—: {{actionModal.cost}}</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-secondary" catchtap="cancelAction">å–æ¶ˆ</button>
      <button class="btn btn-primary" catchtap="confirmAction">ç¡®è®¤</button>
    </view>
  </view>
</view>

<!-- æ”¶è·ç»“æœæ¨¡æ€æ¡† -->
<view class="modal" wx:if="{{showHarvestModal}}">
  <view class="modal-content harvest-modal">
    <view class="modal-header">ğŸ‰ æ”¶è·æˆåŠŸï¼</view>
    <view class="harvest-result">
      <image src="/images/coffee-beans.png"></image>
      <view class="harvest-info">
        <text class="harvest-title">è·å¾— {{harvestResult.varietyName}} å’–å•¡è±†</text>
        <text class="harvest-amount">æ•°é‡: {{harvestResult.amount}}g</text>
        <text class="harvest-quality">å“è´¨: {{harvestResult.quality}}</text>
      </view>
    </view>
    <view class="harvest-rewards">
      <text>é¢å¤–å¥–åŠ±:</text>
      <view class="reward-item" wx:for="{{harvestResult.rewards}}" wx:key="type">
        <image src="{{item.icon}}"></image>
        <text>{{item.name}} +{{item.amount}}</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn btn-primary" bindtap="closeHarvestModal">å¤ªæ£’äº†ï¼</button>
    </view>
  </view>
</view>